<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Lens PMC</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!-- Le styles -->
  <link href="docs/assets/css/bootstrap.css" rel="stylesheet">
  <style type="text/css">
    body {
      padding-top: 20px;
      padding-bottom: 60px;
    }

    /* Custom container */
    .container {
      margin: 0 auto;
      max-width: 1000px;
    }
    

    /* Supporting marketing content */
    .marketing {
      margin: 60px 0;
    }
    .marketing p + h4 {
      margin-top: 28px;
    }


    /* Customize the navbar links to be fill the entire space of the .navbar */
    .navbar .navbar-inner {
      padding: 0;
    }
    .navbar .nav {
      margin: 0;
      display: table;
      width: 100%;
    }
    .navbar .nav li {
      display: table-cell;
      width: 1%;
      float: none;
    }
    .navbar .nav li a {
      font-weight: bold;
      text-align: center;
      border-left: 1px solid rgba(255,255,255,.75);
      border-right: 1px solid rgba(0,0,0,.1);
    }
    .navbar .nav li:first-child a {
      border-left: 0;
      border-radius: 3px 0 0 3px;
    }
    .navbar .nav li:last-child a {
      border-right: 0;
      border-radius: 0 3px 3px 0;
    }
  </style>
  <link href="docs/assets/css/bootstrap-responsive.css" rel="stylesheet">

  <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="docs/assets/js/html5shiv.js"></script>
      <![endif]-->

      <!-- Fav and touch icons -->
      <link rel="apple-touch-icon-precomposed" sizes="144x144" href="docs/assets/ico/apple-touch-icon-144-precomposed.png">
      <link rel="apple-touch-icon-precomposed" sizes="114x114" href="docs/assets/ico/apple-touch-icon-114-precomposed.png">
      <link rel="apple-touch-icon-precomposed" sizes="72x72" href="docs/assets/ico/apple-touch-icon-72-precomposed.png">
      <link rel="apple-touch-icon-precomposed" href="docs/assets/ico/apple-touch-icon-57-precomposed.png">
      <link rel="shortcut icon" href="docs/assets/ico/favicon.png">
    </head>

    <body>

      <div class="container search-results">

        <div class="masthead">
          <!--h3 class="muted">Lens PMC</h3-->
          <div class="navbar">
            <div class="navbar-inner">
              <div class="container">
                <ul class="nav">
                  <li class="active"><a href="index.html">Home</a></li>
                  <li><a href="about.html">About</a></li>
                  <li><a href="contact.html">Contact</a></li>
                </ul>
              </div>
            </div>
          </div><!-- /.navbar -->
        </div>
        
     <!--      <header class="header">
            <h1>12345 results</h1>
          </header> -->
<div class="row">
          <div class="input-append search-bar span8 pull-right">
            <input class="search span7" id="search" type="text">
            <button class="btn btn-inverse" type="button" onclick="callPMC();">Search!</button>
          </div>
        </div>    

        <section class="row">
          <sidebar class="span2 form-inline">
           <h3>OA</h3>
           <ul class="unstyled">
            <li><label class="radio" name="full_only"><input type="radio" checked="checked" name="full_only"/>Full Article Only</label></li>
            <li><label class="radio" name="all_results"><input type="radio" name="all_results"/>All Results</label></li>

          </ul>
          <h3>Journals</h3>
          <ul class="unstyled">
            <li><label class="checkbox"><input type="checkbox" name="blah"/>eLife</label></li>
            <li><label class="checkbox"><input type="checkbox" name="blah"/>PeerJ</label></li>
            <li><label class="checkbox"><input type="checkbox" name="blah"/>BioMed Central</label></li>
            <li><label class="checkbox"><input type="checkbox" name="blah"/>PLOS</label></li>
          </ul>
        </sidebar>
        <article class="span8 result-list">
          <ul class="unstyled">
            <li><h4><a href="lens/?url=http%3A%2F%2Feutils.ncbi.nlm.nih.gov%2Fentrez%2Feutils%2Fefetch.fcgi%3Fdb%3Dpmc%26id%3D3144511" target="_blank">Enhanced apoptotic and reduced protective response in chondrocytes following endoplasmic reticulum stress in osteoarthritic cartilage</a></h4>
              <p>

                Koji Takada, Jun Hirose, Kei Senba, Soichiro Yamabe, Yuichi Oike, Tomomi Gotoh, Hiroshi Mizuta
                <br/>
                <i>Int J Exp Pathol.</i> 2011 August
              </p>
            </li>
            <li><h4><a href="lens/?url=http%3A%2F%2Feutils.ncbi.nlm.nih.gov%2Fentrez%2Feutils%2Fefetch.fcgi%3Fdb%3Dpmc%26id%3D3144511" target="_blank">Enhanced apoptotic and reduced protective response in chondrocytes following endoplasmic reticulum stress in osteoarthritic cartilage</a></h4>
              <p>

                Koji Takada, Jun Hirose, Kei Senba, Soichiro Yamabe, Yuichi Oike, Tomomi Gotoh, Hiroshi Mizuta
                <br/>
                <i>Int J Exp Pathol.</i> 2011 August
              </p>
            </li>
            <li><h4><a href="lens/?url=http%3A%2F%2Feutils.ncbi.nlm.nih.gov%2Fentrez%2Feutils%2Fefetch.fcgi%3Fdb%3Dpmc%26id%3D3144511" target="_blank">Enhanced apoptotic and reduced protective response in chondrocytes following endoplasmic reticulum stress in osteoarthritic cartilage</a></h4>
              <p>

                Koji Takada, Jun Hirose, Kei Senba, Soichiro Yamabe, Yuichi Oike, Tomomi Gotoh, Hiroshi Mizuta
                <br/>
                <i>Int J Exp Pathol.</i> 2011 August
              </p>
            </li>
        </ul>

        <div class="pagination">
          <ul>
            <li><a href="#">Prev</a></li>
            <li><a href="#">1</a></li>
            <li><a href="#">2</a></li>
            <li><a href="#">3</a></li>
            <li><a href="#">4</a></li>
            <li><a href="#">5</a></li>
            <li><a href="#">Next</a></li>
          </ul>
        </div>
        
      </article>


    </section>
  </div> <!-- /container -->
    <!--Example Articles
http%3A%2F%2Feutils.ncbi.nlm.nih.gov%2Fentrez%2Feutils%2Fefetch.fcgi%3Fdb%3Dpmc%26id%3D3144511
http%3A%2F%2Feutils.ncbi.nlm.nih.gov%2Fentrez%2Feutils%2Fefetch.fcgi%3Fdb%3Dpmc%26id%3D1664609
http%3A%2F%2Feutils.ncbi.nlm.nih.gov%2Fentrez%2Feutils%2Fefetch.fcgi%3Fdb%3Dpmc%26id%3D165743
http%3A%2F%2Feutils.ncbi.nlm.nih.gov%2Fentrez%2Feutils%2Fefetch.fcgi%3Fdb%3Dpmc%26id%3D3687364
http%3A%2F%2Feutils.ncbi.nlm.nih.gov%2Fentrez%2Feutils%2Fefetch.fcgi%3Fdb%3Dpmc%26id%3D3792178
http%3A%2F%2Feutils.ncbi.nlm.nih.gov%2Fentrez%2Feutils%2Fefetch.fcgi%3Fdb%3Dpmc%26id%3D3410810

http%3A%2F%2Feutils.ncbi.nlm.nih.gov%2Fentrez%2Feutils%2Fefetch.fcgi%3Fdb%3Dpmc%26id%3D1362254
http%3A%2F%2Feutils.ncbi.nlm.nih.gov%2Fentrez%2Feutils%2Fefetch.fcgi%3Fdb%3Dpmc%26id%3D382300
http%3A%2F%2Feutils.ncbi.nlm.nih.gov%2Fentrez%2Feutils%2Fefetch.fcgi%3Fdb%3Dpmc%26id%3D139019
http%3A%2F%2Feutils.ncbi.nlm.nih.gov%2Fentrez%2Feutils%2Fefetch.fcgi%3Fdb%3Dpmc%26id%3D3766205
-->
<!--Example Articles PMC URL
http://www.ncbi.nlm.nih.gov/pmc/articles/PMC3144511/
http://www.ncbi.nlm.nih.gov/pmc/articles/PMC1664609/
http://www.ncbi.nlm.nih.gov/pmc/articles/PMC165743/
http://www.ncbi.nlm.nih.gov/pmc/articles/PMC3687364/
http://www.ncbi.nlm.nih.gov/pmc/articles/PMC3792178/
http://www.ncbi.nlm.nih.gov/pmc/articles/PMC3410810/


-->

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="docs/assets/js/bootstrap-transition.js"></script>
    <script src="docs/assets/js/bootstrap-alert.js"></script>
    <script src="docs/assets/js/bootstrap-modal.js"></script>
    <script src="docs/assets/js/bootstrap-dropdown.js"></script>
    <script src="docs/assets/js/bootstrap-scrollspy.js"></script>
    <script src="docs/assets/js/bootstrap-tab.js"></script>
    <script src="docs/assets/js/bootstrap-tooltip.js"></script>
    <script src="docs/assets/js/bootstrap-popover.js"></script>
    <script src="docs/assets/js/bootstrap-button.js"></script>
    <script src="docs/assets/js/bootstrap-collapse.js"></script>
    <script src="docs/assets/js/bootstrap-carousel.js"></script>
    <script src="docs/assets/js/bootstrap-typeahead.js"></script>
    <script src="docs/assets/js/bootstrap-paginator.min.js"></script>
    <script src="docs/assets/js/jquery-dateFormat.min.js"></script>
    <script type=text/javascript>
      function callPMC(currentPage) {
  if (typeof(currentPage)==='undefined') currentPage = 1;

  // get the query term.
  var queryTerm = $("#search").val();

  var retmax = 10;
    // get the start. 
  var retstart = (currentPage - 1) * retmax;
  
  var searchUrl = "http://eutils.ncbi.nlm.nih.gov/entrez/eutils/esearch.fcgi?db=pmc&term=" + queryTerm + "&retmax=" + retmax + "&retstart=" + retstart;
  console.log("search url: " + searchUrl);
  var request = $.get(searchUrl);
  var chained = request.then(function(data) {
    var total = $(data).find("eSearchResult > Count").text();
    console.log("total search results: " + total);
    var totalPages = (total / retmax);
    if (total % retmax > 0) {
      totalPages = totalPages + 1;
    }

    var options = {
      currentPage: currentPage,
      totalPages: totalPages,
      onPageClicked: function(e, originalEvent, type, page) {
        console.log(page + " page clicked");
        callPMC(page);
      }
    };

    $('.pagination').bootstrapPaginator(options);

    var pmcIds = $.map($(data).find("IdList Id"), function(val, index) {
      return $(val).text();
    });
    console.log("pmcIds: " + pmcIds);
    
    var metadataUrl = "http://eutils.ncbi.nlm.nih.gov/entrez/eutils/esummary.fcgi?db=pmc&id=" + pmcIds.join(",");
    console.log("metadata url: " + metadataUrl);
    return $.get(metadataUrl);
  });

  chained.done(function(data) {
    $("article > ul").empty();

    $(data).find("eSummaryResult > DocSum").each(function(index, val) {
      var title = $(val).find("Item[Name='Title']").text();
      var authors = $.map($(val).find("Item[Name='AuthorList'] > Item"), function(val, index) {
        return $(val).text(); 
      }).join(", ");

      var pubDate = $(val).find("Item[Name='PubDate']").text();
      var ePubDate = $(val).find("Item[Name='EPubDate']").text();
      
      var source = $(val).find("Item[Name='Source']").text();
      var so = $(val).find("Item[Name='SO']").text();
      so = so.replace(";", "; ");
      so = so.replace(":", ": ");

      // formatting info
      var info = source + ". " + so;
      if (pubDate.length == 0) {
        info = source + ". " + ePubDate.substring(0, 4) + so;
      }       

      // logic around displaying published date
      // 2011 November 17
      var published = "Published ";
      if (ePubDate.length > 0) {
        // epubdate: 2013/09/30
        var date = new Date(ePubDate.substring(0, 4), ePubDate.substring(5, 7), ePubDate.substring(8, 10));
        date = $.format.date(date, "yyyy MMM d");
        published = published + "online " + date;
      } else if (pubDate.length > 0) {
        // pubdate: 2013 Oct 15
        published = published + "on " + pubDate;
      }

      var pmId = $(val).find("Item[Name='ArticleIds'] > Item[Name='pmid']").text();
      var pmcId = $(val).find("Item[Name='ArticleIds'] > Item[Name='pmcid']").text();
      var doi = $(val).find("Item[Name='ArticleIds'] > Item[Name='doi']").text();

      var pmcUrl = encodeURI("http%3A%2F%2Feutils.ncbi.nlm.nih.gov%2Fentrez%2Feutils%2Fefetch.fcgi%3Fdb%3Dpmc%26id%3D" + pmcId)

      var result = $("<li>")
      .append(
        $("<h4>").append($("<a>").attr("href", "lens/?url=" + pmcUrl).attr("target", "_blank").text(title))
      )
      .append(
        $("<p>")
        .append(authors)
        .append($("<br>"))
        .append($("<i>").append(info))
        .append(".&nbsp;&nbsp;")
        .append(published)
        .append($("<br>"))
        .append("doi: " + doi)
      );

      $("article > ul").append(result);

    });
  });

      }
    </script>

  </body>
  </html>
